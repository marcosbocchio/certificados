<template>
    <div class="row">
        <div class="col-md-12">
            <form @submit.prevent="editmode ?  Update() : Store()"  method="post">
                <informe-header :otdata="otdata" :deshabilitarPlanta_sn="isGasoducto" :informe_id="informedata.id" :editmode="editmode" @set-obra="setObra" @set-planta="setPlanta" ref="informeHeader"></informe-header>
                <div class="box box-custom-enod">
                   <div class="box-body">
                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="formato">Tipo informe RI *</label>
                                 <v-select v-model="formato" :options="['PLANTA', 'DUCTO','PERFILES']" @input="cambiopTipoInforme" ></v-select>
                             </div>
                         </div>
                         <div class="col-md-3">
                             <div class="form-group">
                                  <label for="fecha">Fecha *</label>
                                 <div>
                                     <date-picker v-model="fecha" value-type="YYYY-MM-DD" format="DD-MM-YYYY" placeholder="DD-MM-YYYY" autocomplete="new-password" ></date-picker>
                                 </div>
                             </div>
                         </div>

                         <div class="col-md-6">
                             <div class="row">
                                 <div class="col-md-3" v-if="formato=='DUCTO'">
                                     <div class="form-group" >
                                         <div v-if="isGasoducto">
                                             <label for="pk">PK *</label>
                                         </div>
                                         <div v-else>
                                             <label for="pk">PK</label>
                                         </div>
                                       <input type="number" v-model="pk" class="form-control" id="pk" :disabled="((!isGasoducto) || reparacion_sn== true || reparacion_sn == 1)" min="-1">
                                     </div>
                                 </div>

                                    <div v-if="isGasoducto">
                                        <div class="col-md-3">
                                                <div class="form-group" >
                                                    <label for="ot_obra_tipo_soldaduras">Tipo Sol *</label>
                                                    <input type="checkbox" id="reparacion_sn" v-model="reparacion_sn" :disabled="!pk || !tipo_soldadura" @change="cambioReparacion_sn()" style="float:right">
                                                    <label for="reparacion_sn" style="float:right;margin-right: 5px;">R</label>
                                                    <v-select v-model="tipo_soldadura" label="codigo" :options="ot_tipo_soldaduras_filter_R" id="ot_obra_tipo_soldaduras" @input="cambioOtTipoSoldadura" :disabled="(!isGasoducto || !obra || !pk )"></v-select>
                                                </div>
                                        </div>
                                    </div>
                                    <div v-else>
                                    <div class="col-md-3">
                                        <label for="reparacion_sn" v-if="formato=='PLANTA'" style="display:block">&nbsp;</label>
                                        <input type="checkbox" id="reparacion_sn" style="float:left;margin-right: 5px;" v-model="reparacion_sn" @change="cambioReparacion_sn()" :disabled="!obra" v-if="formato=='PLANTA'">
                                        <label for="reparacion_sn" v-if="formato=='PLANTA'">Reparación s/n</label>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="reparacion_sn" v-if="formato=='PLANTA'" style="display:block">&nbsp;</label>
                                        <input type="checkbox" id="ptt_sn" style="float:left;margin-right: 5px;" :checked="ptt_sn" @click="cambioPtt_sn()" :disabled="!obra" v-if="formato === 'PLANTA'">
                                        <label for="ptt_sn" v-if="formato === 'PLANTA'">PTT s/n</label>
                                    </div>
                                    </div>

                                 <div class="col-md-6">
                                     <div class="form-group" >
                                         <label for="numero_inf">Informe N°</label>
                                         <input type="text" v-model="numero_inf_code" class="form-control" id="numero_inf" disabled>
                                     </div>
                                 </div>
                             </div>
                         </div>

                         <div class="clearfix"></div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="componente">Componente *</label>
                                 <input type="text" v-model="componente" class="form-control" id="componente" maxlength="30">
                             </div>
                         </div>

                         <div class="col-md-3" >
                             <div class="form-group">
                                 <label for="material">Material *</label>
                                 <v-select v-model="material" label="codigo" :options="materiales" id="material"></v-select>
                             </div>
                         </div>


                         <div class="col-md-3" >
                             <div class="form-group">
                                <label for="material2">Material </label>
                                <input type="radio" id="caño" value="Caño" v-model="material2_tipo" style="float:right">
                                <label for="caño" style="float:right;margin-right: 5px;margin-left:5px" title="Caño">Caño</label>
                                <input type="radio" id="accesorio" value="Accesorio" v-model="material2_tipo" style="float:right">
                                <label for="accesorio" style="float:right;margin-right: 5px;margin-left:5px" title="Accesorio">Acces.</label>
                                 <v-select v-model="material2" label="codigo" :options="materiales" id="material2"></v-select>
                             </div>
                         </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="procRadio">Procedimiento RI *</label>
                                <v-select v-model="procedimiento" label="titulo" :options="procedimientos" id="procRadio" :appendToBody="appendToBody" :autoscroll="true"></v-select>
                            </div>
                        </div>

                        <div class="clearfix"></div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="linea">Linea</label>
                                 <input type="text" v-model="linea" @change="getElementosReparacion" class="form-control" id="linea" maxlength="30">
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="plano_isom">Plano / Isom *</label>
                                 <input type="text" v-model="plano_isom" class="form-control" id="plano_isom" @change="getElementosReparacion" maxlength="30">
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="hoja">Hoja</label>
                                 <input type="text" v-model="hoja" class="form-control" id="hoja" @change="getElementosReparacion" maxlength="10">
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="Diametro">Ø *</label>
                                 <v-select v-model="diametro" label="diametro" :options="diametros" taggable @input="changeDiametro(diametro)"></v-select>
                             </div>
                         </div>

                        <div class="clearfix"></div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                <div v-if="isChapa">
                                     <label for="espesor">Espesor</label>
                                 </div>
                                 <div v-else>
                                      <label for="espesor">Espesor *</label>
                                 </div>
                                 <v-select v-model="espesor" label="espesor" :options="espesores" taggable :disabled="isChapa" @input="cambioEspesor()">
                                     <template slot="option" slot-scope="option">
                                         <span class="upSelect">{{ option.espesor }} </span> <br>
                                         <span class="downSelect"> {{ option.cuadrante }} </span>
                                     </template>
                                 </v-select>
                             </div>
                         </div>

                         <div class="col-md-3">
                              <div class="form-group" >
                                 <div v-if="isChapa">
                                     <label for="espesor_chapa">Espesor Chapa *</label>
                                 </div>
                                 <div v-else>
                                      <label for="espesor_chapa">Espesor Chapa </label>
                                 </div>
                                 <input  type="number" class="form-control" v-model="espesor_chapa"  id="espesor_chapa" :disabled="!isChapa" step="0.1" >
                              </div>
                         </div>

                         <div v-if="!reparacion_sn" class="col-md-3">
                             <div class="form-group size-pqr-eps"  >
                                 <label for="procedimientos_soldadura">EPS / WPS *</label>
                                 <v-select v-model="ot_tipo_soldadura" label="eps" :options="ot_tipo_soldaduras_filter_codigo" id="procedimientos_soldadura"></v-select>
                             </div>
                         </div>

                         <div v-else  class="col-md-3">
                             <div class="form-group size-pqr-eps" >
                                 <label for="eps_r">EPS / WPS *</label>
                                  <v-select v-model="ot_tipo_soldadura" label="proc_reparacion" :options="ot_tipo_soldaduras_filter_codigo" id="procedimientos_soldadura"></v-select>
                             </div>
                         </div>

                        <div v-if="!reparacion_sn" class="col-md-3">
                             <div class="form-group size-pqr-eps" >
                                 <label for="pqr">PQR</label>
                                 <v-select v-model="ot_tipo_soldadura" label="pqr" :options="ot_tipo_soldaduras_filter_codigo" id="pqr"></v-select>
                             </div>
                         </div>

                         <div v-else  class="col-md-3">
                             <div class="form-group size-pqr-eps" >
                                 <label for="pqr_r">PQR</label>
                                  <input type="text" class="form-control" id="pqr_r" disabled>
                             </div>
                         </div>

                        <div class="clearfix"></div>

                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Equipo *</label>
                                 <v-select  v-model="interno_equipo" :options="interno_equipos" label="nro_interno" @input="getFuente()">
                                     <template slot="option" slot-scope="option">
                                         <span class="upSelect">{{ option.nro_interno }}</span> <br>
                                         <span class="downSelect"> {{ option.equipo.codigo }} </span>
                                     </template>
                                 </v-select>
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="fuente">Fuente</label>
                                  <input type="text" v-model="fuente.codigo" class="form-control" id="fuente" disabled>
                             </div>
                         </div>

                         <div v-if="(fuente)" class="col-md-3">
                             <div class="form-group" >
                                 <label for="foco">Foco </label>
                                 <input type="text" v-model="interno_fuente.foco" class="form-control" id="foco" disabled>
                                 
                             </div>
                         </div>
                         <div v-else class="col-md-3">
                           <div class="form-group" >
                                 <label for="foco">Foco </label>
                                 <input type="text" v-model="interno_equipo.foco" class="form-control" id="foco" disabled>
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="actividad">Actividad</label>
                                 <input type="text" v-model="actividad" class="form-control" id="actividad" disabled>
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="kv">Kv</label>
                                 <input  type="number" class="form-control" v-model="kv" id="kv" :disabled="interno_equipo.interno_fuente" max="9999" step="0.1">
                             </div>
                         </div>
                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="ma">mA</label>
                                 <input  type="number" class="form-control" v-model="ma" id="ma" :disabled="interno_equipo.interno_fuente" max="9999" step="0.1">
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Calidad de placas *</label>
                                     <v-select  v-model="tipo_pelicula" :options="tipo_peliculas" label="codigo">
                                         <template slot="option" slot-scope="option">
                                             <span class="upSelect">{{ option.codigo }}</span> <br>
                                             <span class="downSelect"> {{ option.fabricante }} </span>
                                         </template>
                                     </v-select>
                             </div>
                         </div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="cm">Medida de Placa*</label>
                                 <v-select type="text" v-model="medida" label="codigo" id="cm" :options="medidas_placa" style="display: block" taggable  @input="cambioMedida"></v-select>
                             </div>
                         </div>

                        <div class="clearfix"></div>

                         <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="ici">Ici *</label>
                                 <v-select v-model="ici" label="codigo" :options="icis"></v-select>
                             </div>
                         </div>

                        <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="pantalla">Pantalla</label>
                                 <input type="text" v-model="pantalla" class="form-control" id="pantalla" disabled>
                             </div>
                         </div>

                        <div class="col-md-3">
                             <div class="form-group" >
                                 <label for="pos_ant">Ant *</label>
                                 <input type="number" v-model="pos_ant" class="form-control" id="pos_ant" step=".01">
                             </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group" >
                                <label for="pos_pos">Pos *</label>
                                <input type="number" v-model="pos_pos" class="form-control" id="pos_pos" step=".01">
                            </div>
                        </div>

                        <div class="clearfix"></div>

                        <div class="col-md-3">
                             <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Norma Evaluación *</label>
                                        <v-select v-model="norma_evaluacion" label="codigo" :options="norma_evaluaciones">
                                            <template slot="option" slot-scope="option">
                                                <span class="upSelect">{{ option.codigo }}</span> <br>
                                                <span class="downSelect"> {{ option.descripcion }} </span>
                                            </template>
                                        </v-select>
                                    </div>
                                </div>
                             </div>
                             <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" >
                                        <label for="pos_pos">Lado *</label>
                                        <input type="text" v-model="lado" class="form-control" id="lado">
                                    </div>
                                </div>
                             </div>
                             <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" >
                                        <label for="ejecutor_ensayo">Ejecutor Ensayo *</label>
                                        <v-select v-model="ejecutor_ensayo" label="name" :options="ejecutor_ensayos"></v-select>
                                    </div>
                                </div>
                             </div>
                        </div>

                        <div class="col-md-3">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Norma Ensayo *</label>
                                        <v-select v-model="norma_ensayo" label="codigo" :options="norma_ensayos">
                                            <template slot="option" slot-scope="option">
                                                <span class="upSelect">{{ option.codigo }}</span> <br>
                                                <span class="downSelect"> {{ option.descripcion }} </span>
                                            </template>
                                        </v-select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" >
                                        <label for="exposicion">N° Exposiciones *</label>
                                        <input type="number" v-model="exposicion" class="form-control" id="exposicion">
                                    </div>
                                </div>
                           </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" >
                                        <label for="ejecutor_ensayo">Solicitante </label>
                                        <v-select v-model="solicitado_por" label="name" :options="usuarios_cliente"></v-select>
                                    </div>
                                </div>
                           </div>
                        </div>

                        <div class="col-md-3">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Técnica *</label>
                                        <v-select v-model="tecnica" label="codigo" :options="tecnicas" @input="ActualizarDistFuentePelicula()" :disabled="isChapa">
                                            <template slot="option" slot-scope="option">
                                                <span class="upSelect">{{ option.codigo }}</span> <br>
                                                <span class="downSelect"> {{ option.descripcion }} </span>
                                            </template>
                                        </v-select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" >
                                        <label for="distancia_fuente_pelicula">Dist. Fuente/Film *</label>
                                        <input type="number" step="0.01" v-model="distancia_fuente_pelicula" class="form-control" :disabled="diametro.diametro!='VARIOS' && !dist_fuente_pel_edit_sn" id="distancia_fuente_pelicula">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="N_Reporte_RFI">N Reporte /RFI</label>
                                        <input type="text" v-model="N_Reporte_RFI" class="form-control" placeholder="N Reporte /RFI" id="N_Reporte_RFI" name="N_Reporte_RFI" maxlength="30">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-if="!isLoading" class="col-md-3">
                             <div class="row">
                                <div class="col-md-12" >
                                    <label>&nbsp;</label>
                                    <div v-if="tecnica.path" class="thumbnail" style="border:solid 1px">
                                        <img :src="tecnica.path" alt="..." >
                                    </div>
                                    <div v-else class="thumbnail" style="border:solid 1px">
                                         <img :src="'/img/tecnicas/imagen_no_disponible.jpg'" alt="..." >
                                    </div>
                               </div>
                           </div>
                        </div>
                   </div>
                </div>

                <div class="box box-custom-enod">
                    <div class="box-body">

                        <div class="col-md-3">
                            <div class="form-group" >
                                <label for="modelos_3d">Modelos 3D</label>
                                <v-select v-model="modelo_3d" label="codigo" :options="modelos_3d" id="modelos_3d" ></v-select>
                            </div>
                         </div>

                         <div class="clearfix"></div>

                         <div class="col-md-1">
                            <span>
                              <button type="button" @click="addModelo()"><span class="fa fa-plus-circle"></span></button>
                            </span>
                         </div>
                         <div class="form-group">
                             &nbsp;
                         </div>
                        <div v-if="TablaModelos3d.length">
                            <div class="col-sm-6">
                                <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered table-condensed">
                                        <thead>
                                            <tr>
                                                <th class="col-sm-12">Modelo</th>
                                                <th>&nbsp;</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="(item,k) in (TablaModelos3d)" :key="k" class="pointer">

                                                <td>
                                                    {{ item.codigo }}
                                                </td>
                                                <td>
                                                    <a  @click="RemoveModelo(k)"> <app-icon img="minus-circle" color="black"></app-icon> </a>
                                                </td>

                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box box-custom-enod" v-if="formato != 'PERFILES'">
                      <div class="box-header with-border">
                         <h3 class="box-title">ELEMENTOS/POSICIONES</h3>
                         <div class="box-tools pull-right">
                             <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                             </button>
                         </div>
                     </div>
                 <div class="box-body">

                 <div v-if="!reparacion_sn" class="col-md-2">
                     <div class="form-group" >
                         <label for="junta">Elemento</label>
                         <input type="text" v-model="junta" class="form-control" id="junta" maxlength="10">
                     </div>
                 </div>
                 <div v-else>
                     <div class="col-md-3">
                         <div class="form-group" >
                             <label for="juntas_reparacion">Elemento a Reparar</label>
                             <v-select v-model="junta_reparacion" label="codigo" :options="juntas_reparacion" id="defecto_sector"></v-select>
                         </div>
                     </div>
                 </div>

                 <div class="col-md-2">
                     <div class="form-group" >
                         <label for="densidad">Densidad</label>
                         <input type="number" v-model="densidad" class="form-control" id="densidad" step="0.1">
                     </div>
                 </div>

                 <div class="col-md-2">
                     <div class="form-group" >
                     <label for="posicion">Posición</label>
                     <input type="text" v-model="posicion" class="form-control" id="posicion">
                     </div>
                 </div>


                 <div class="col-md-2">
                        <p>&nbsp;</p>
                        <button type="button" @click="AddDetalle()" title="Agregar Junta/Posición"><app-icon img="plus-circle" color="black"></app-icon></button>
                        <button type="button" @click="ClonarPosPlanta()" title="Clonar Posición"><app-icon img="clone" color="black"></app-icon></button>
                        <button type="button" @click="OpenClonacionMasiva()" title="Clonación masiva"><app-icon img="list-ol" color="black"></app-icon></button>
                        <button type="button" @click="resetDetalle()" title="Limpiar Todo"><app-icon img="trash" color="black"></app-icon></button>
                 </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label for="resultado_pdf_label" style="display:block">&nbsp;</label>
                        <input type="checkbox" id="checkbox" v-model="resultado_pdf_sn" style="float:right">
                        <label for="resultado_pdf_sn" style="float:right;margin-right: 5px;">Mostrar resultado en PDF</label>
                    </div>
                </div>

                 <div class="form-group">
                     &nbsp;
                 </div>

                     <div v-if="TablaDetalle.length">
                         <div class="col-md-12">
                             <div class="table-responsive">
                                 <table class="table table-hover table-bordered table-condensed">
                                     <thead>
                                         <tr>
                                             <th class="col-md-2">Elemento</th>
                                             <th class="col-md-2">Densidad</th>
                                             <th class="col-md-2">Pos.</th>
                                             <th class="col-md-1">Aceptable</th>
                                             <th class="col-md-5">Observación</th>
                                             <th> &nbsp;</th>
                                         </tr>
                                     </thead>
                                     <tbody>
                                        <template v-for="(FIlaTabla,k) in (TablaDetalle)">
                                            <tr :key="k" :class="{selected: indexDetalle === k}" class="pointer">
                                                <td  @click="selectPosDetalle(k)">{{ FIlaTabla.junta }}</td>
                                                <td  @click="selectPosDetalle(k)">
                                                    <div v-if="indexDetalle == k ">
                                                    <input type="number" v-model="TablaDetalle[k].densidad" step="0.1">
                                                    </div>
                                                    <div v-else>
                                                        {{ FIlaTabla.densidad }}
                                                    </div>
                                                </td>
                                                <td  @click="selectPosDetalle(k)">{{ FIlaTabla.posicion }} </td>
                                                <td  @click="selectPosDetalle(k)"> <input type="checkbox" id="checkbox" v-model="TablaDetalle[k].aceptable_sn">  </td>
                                                <td  @click="selectPosDetalle(k)">
                                                    <div v-if="indexDetalle == k ">
                                                    <input type="text" v-model="TablaDetalle[k].observacion" maxlength="50" size="60">
                                                    </div>
                                                    <div v-else>
                                                    {{ TablaDetalle[k].observacion }}
                                                    </div>
                                                </td>
                                                <td> <a @click="RemoveDetalle(k)"> <app-icon img="minus-circle" color="black"></app-icon> </a>
                                                </td>
                                            </tr>
                                            <tr>
                                                  <td v-if="k==indexDetalle && indicaciones_sn" colspan="6" style="background-color: #ECF0F5;">

                                                        <div class="box box-custom-enod" style="background-color:#fdfdfd;">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title">INDICACIONES</h3>
                                                                <div class="box-tools pull-right">
                                                                    <button type="button" class="btn btn-box-tool" @click="indicaciones_sn=false"><i class="fa fa-times"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        <div class="box-body">

                                                            <div class="col-md-3">
                                                                <div class="form-group" >
                                                                    <label>Indicación</label>
                                                                    <v-select v-model="defectoRiPlanta" :options="defectosRiPlanta" label="codigo" :disabled="(!TablaDetalle.length)">
                                                                        <template slot="option" slot-scope="option">
                                                                            <span class="upSelect">{{ option.descripcion }} </span> <br>
                                                                            <span class="downSelect">{{ option.codigo }} </span>
                                                                        </template>
                                                                    </v-select>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-2">
                                                                <div class="form-group" >
                                                                    <label for="posicionPlacaGosaducto">Pos. Indicación</label>
                                                                    <input type="text" v-model="posicionPlacaGosaducto" class="form-control" id="posicionPlacaGosaducto" placeholder="XXX-XXX" :disabled="(!TablaDetalle.length)" maxlength="7">
                                                                </div>
                                                            </div>

                                                            <div v-if="formato=='DUCTO'" class="col-md-3">
                                                                <div class="form-group" >
                                                                    <label for="defecto_sector">Pasada</label>
                                                                    <v-select v-model="defecto_sector" label="defecto_sector" :options="['RAIZ','RELLENO','SOBREMONTA']" id="defecto_sector"  :disabled="(!posicionPlacaGosaducto)"></v-select>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-1">
                                                                <div class="form-group">
                                                                    <p>&nbsp;</p>
                                                                    <span>
                                                                    <button type="button" @click="addDefectos()" title="Agregar Defecto"><app-icon img="plus-circle" color="black"></app-icon></button>
                                                                    </span>
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                &nbsp;
                                                            </div>

                                                            <div v-if="TablaDetalle.length && TablaDetalle[indexDetalle].defectos.length">
                                                                <div class="col-md-8">
                                                                    <div class="table-responsive">
                                                                        <table class="table table-bordered table-condensed">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="col-md-2">Código</th>
                                                                                    <th class="col-md-6">Descripción</th>
                                                                                    <th class="col-md-2">Posición</th>
                                                                                    <th v-if="formato=='DUCTO'" class="col-md-2">Sector</th>
                                                                                    <th>&nbsp;</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr v-for="(defectoPasada,k) in ( (TablaDetalle.length > 0 )  ? TablaDetalle[indexDetalle].defectos : [])"  :key="k">
                                                                                    <td>{{ defectoPasada.codigo }}</td>
                                                                                    <td>{{ defectoPasada.descripcion }}</td>
                                                                                    <td>{{ defectoPasada.posicion }}</td>
                                                                                    <td  v-if="formato=='DUCTO'">{{ defectoPasada.pasada }}</td>
                                                                                    <td class="pointer">
                                                                                        <a  @click="RemoveDefectos(k)"> <app-icon img="minus-circle" color="black"></app-icon> </a>
                                                                                    </td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                     </tbody>
                                 </table>
                             </div>
                         </div>
                        </div>
                     </div>
                    </div>

                <div class="box box-custom-enod" v-if="formato == 'PERFILES'">
                    <div class="box-header with-border">
                         <h3 class="box-title">TRAMOS</h3>
                         <div class="box-tools pull-right">
                             <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                             </button>
                         </div>
                     </div>

                 <div class="box-body">
                <div class="col-md-2">
                     <div class="form-group" >
                         <label for="tramo">Tramo</label>
                         <input type="text" v-model="tramo" class="form-control" id="tramo" maxlength="10">
                     </div>
                 </div>
                    <div class="col-md-2">
                        <div class="form-group" >
                            <label for="bola_comparadora">Bola comparadora</label>
                            <input type="number" v-model="bola_comparadora" class="form-control" id="bola_comparadora" step=".01" min="0.01">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group" >
                            <label for="espesor">Espesor</label>
                            <input type="number" v-model="espesor_tramo" class="form-control" id="espesor_tramo" step=".01" min="0.01">
                        </div>
                    </div>
                    <div class="col-md-4">
                     <div class="form-group" >
                         <label for="observaciones">Observaciones</label>
                         <input type="text" v-model="observacion_tramo" class="form-control" id="observacion_tramo" maxlength="100">
                     </div>
                     </div>

                      <div class="col-md-2">
                           <p>&nbsp;</p>
                           <span>
                             <button type="button" @click="AddTramos()" title="Agregar Pasada"><app-icon img="plus-circle" color="black"></app-icon></button>
                           </span>
                     </div>

                     <div class="form-group">
                         &nbsp;
                     </div>

                     <div v-if="TablaTramos.length">
                            <div class="col-md-11">
                                 <div class="table-responsive">
                                     <table class="table table-hover table-striped table-bordered table-condensed">
                                         <thead>
                                             <tr>
                                                 <th class="col-md-1">Tramo</th>
                                                 <th class="col-md-1.5">Bola comp.</th>
                                                 <th class="col-md-1">Espesor</th>
                                                 <th class="col-md-2">Espesor real</th>
                                                 <th class="col-md-5">Observaciones</th>
                                                 <th class="col-md-1">Ref.</th>
                                                 <th>&nbsp;</th>
                                             </tr>
                                         </thead>
                                            <tbody>
                                                <tr v-for="(tramos,k) in ( (TablaTramos.length > 0 )  ? TablaTramos : [])"  :key="k">
                                                    <td>{{ tramos.tramo }}</td>
                                                    <td>{{ tramos.bola_comparadora }}</td>
                                                    <td>{{ tramos.espesor_tramo }}</td>
                                                    <td>{{ tramos.espesor_real }}</td>
                                                    <td>{{ tramos.observacion_tramo }}</td>
                                                    <td style="text-align:center" v-if=" k === 0">
                                                        <span :class="{ existe : (tramos.observaciones ||
                                                                                    tramos.path1 ||
                                                                                    tramos.path2 ||
                                                                                    tramos.path3 ||
                                                                                    tramos.path4 )
                                                    }"  class="fa fa-file-archive-o" @click="OpenReferencias($event,k,'Informe RI',tramos)" ></span>
                                                    </td>
                                                    <td v-else-if=" k != 0">&nbsp;</td>
                                                    <td class="pointer">
                                                        <a  @click="RemoveTramos(k)"> <app-icon img="minus-circle" color="black"></app-icon> </a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                     </table>
                                 </div>
                             </div>
                         </div>
                   </div>
                 </div>

                 <div class="box box-custom-enod" v-if="formato != 'PERFILES'">
                    <div class="box-header with-border">
                         <h3 class="box-title">PASADAS</h3>
                         <div class="box-tools pull-right">
                             <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                             </button>
                         </div>
                     </div>

                 <div class="box-body">

                     <div class="col-md-2">
                         <div class="form-group" >
                             <label for="elemento_pasadas">Elemento</label>
                             <v-select v-model="elemento_pasada" :options="elemento_pasadas" @input="autocompletarNumeroPasada" id="elemento_pasadas"></v-select>
                         </div>
                     </div>

                     <div class="col-md-2">
                         <div class="form-group" >
                             <label for="pasada">N° Pasada</label>
                             <input type="number" v-model="pasada" class="form-control" id="pasada" disabled>
                         </div>
                     </div>
                     <div class="col-md-2">

                         <label>Cuño P</label>

                         <v-select v-model="soldador3" :options="soldadores" label="codigo" :disabled="(!TablaDetalle.length)">
                             <template slot="option" slot-scope="option">
                                 <span class="upSelect">{{ option.nombre }} </span> <br>
                                 <span class="downSelect"> {{ option.codigo }} </span>
                             </template>
                         </v-select>

                     </div>
                     <div v-if="isGasoducto">
                         <div class="col-md-2">

                             <label>Cuño L</label>

                             <v-select v-model="soldador2" :options="soldadores" label="codigo" :disabled="(!isGasoducto || pasada!='1' || !TablaDetalle.length)">
                                 <template slot="option" slot-scope="option">
                                     <span class="upSelect">{{ option.nombre }} </span> <br>
                                     <span class="downSelect"> {{ option.codigo }} </span>
                                 </template>
                             </v-select>
                         </div>
                     </div>

                     <div class="col-md-2">

                         <label>Cuño Z</label>
                         <v-select v-model="soldador1" :options="soldadores" label="codigo" :disabled="(!TablaDetalle.length)">
                             <template slot="option" slot-scope="option">
                                 <span class="upSelect">{{ option.nombre }} </span> <br>
                                 <span class="downSelect"> {{ option.codigo }} </span>
                             </template>
                         </v-select>
                     </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="proceso">Proceso</label>
                            <v-select v-model="proceso_soldadores" :options="['GMAW', 'GTAW','SAW','SMAW','FCAW']"></v-select>
                        </div>
                    </div>
                      <div class="col-md-2">
                           <p>&nbsp;</p>
                           <span>
                             <button type="button" @click="AddPasadas()" title="Agregar Pasada"><app-icon img="plus-circle" color="black"></app-icon></button>
                             <button type="button"  @click="ModalClonarSoldadores()" title="Clonar Soldadores"><app-icon img="clone" color="black"></app-icon></button>
                              <button type="button" @click="ModalImportarSoldadores()"  :disabled="(!isGasoducto)" title="Importar Soldadores"><app-icon img="file-excel-o" color="black"></app-icon></button>
                             <button type="button" @click="getSoldadores()" title="Recargar Cuños"><app-icon img="refresh" color="black"></app-icon></button>
                           </span>
                     </div>

                     <div class="form-group">
                         &nbsp;
                     </div>

                     <div v-if="TablaPasadas.length">
                            <div class="col-md-11">
                                 <div class="table-responsive">
                                     <table class="table table-hover table-striped table-bordered table-condensed">
                                         <thead>
                                             <tr>
                                                 <th class="col-md-2">Elemento</th>
                                                 <th class="col-md-1">N° Pasada</th>
                                                 <th class="col-md-3">Cuño P</th>
                                                 <th class="col-md-3">Cuño L</th>
                                                 <th class="col-md-3">Cuño Z</th>
                                                 <th class="col.md-3">Proceso</th>
                                                 <th>&nbsp;</th>
                                             </tr>
                                         </thead>
                                         <tbody>
                                             <tr v-for="(Pasada,k) in  (TablaPasadas)" :key="k" @click="selectPosPasadas(k)" class="pointer">
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">{{ Pasada.elemento_pasada }}</td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">{{ Pasada.pasada }}</td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">
                                                     <div v-if="indexPasada == k">
                                                         <v-select v-model="TablaPasadas[indexPasada].soldador3" :options="soldadores" label="codigo">
                                                             <template slot="option" slot-scope="option">
                                                                 <span class="upSelect">{{ option.nombre }} </span> <br>
                                                                 <span class="downSelect"> {{ option.codigo }} </span>
                                                             </template>
                                                         </v-select>
                                                     </div>
                                                     <div v-else>
                                                         {{ Pasada.soldador3.codigo }}
                                                     </div>
                                                 </td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">
                                                     <div v-if="indexPasada == k ">
                                                         <v-select v-model="TablaPasadas[indexPasada].soldador2" :options="soldadores" label="codigo" :disabled="(!isGasoducto || TablaPasadas[indexPasada].pasada!='1' || !TablaDetalle.length)">
                                                             <template slot="option" slot-scope="option">
                                                                 <span class="upSelect">{{ option.nombre }} </span> <br>
                                                                 <span class="downSelect"> {{ option.codigo }} </span>
                                                             </template>
                                                         </v-select>
                                                     </div>
                                                     <div v-else>
                                                        {{ Pasada.soldador2.codigo }}
                                                     </div>
                                                 </td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">
                                                     <div v-if="indexPasada == k ">
                                                         <v-select v-model="TablaPasadas[indexPasada].soldador1" :options="soldadores" label="codigo">
                                                             <template slot="option" slot-scope="option">
                                                                 <span class="upSelect">{{ option.nombre }} </span> <br>
                                                                 <span class="downSelect"> {{ option.codigo }} </span>
                                                             </template>
                                                         </v-select>
                                                     </div>
                                                     <div v-else>
                                                        {{ Pasada.soldador1.codigo }}
                                                     </div>
                                                 </td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">
                                                    <div v-if="indexPasada == k">
                                                        <v-select v-model="TablaPasadas[indexPasada].proceso_soldadores" :options="['GMAW','GTAW','SAW','SMAW']"></v-select>
                                                    </div>
                                                    <div v-else>
                                                        {{ Pasada.proceso_soldadores }}
                                                    </div>
                                                 </td>
                                                 <td v-if="Pasada.elemento_pasada == elemento_pasada">
                                                     <a  @click="RemovePasada(k)"> <app-icon img="minus-circle" color="black"></app-icon> </a>
                                                 </td>
                                             </tr>
                                         </tbody>
                                     </table>
                                 </div>
                             </div>
                         </div>
                   </div>
                 </div>

                 <div class="box box-custom-enod">
                     <div class="box-body">
                         <div class="form-group">
                             <label>Observaciones</label>
                             <textarea v-model="observaciones" class="form-control noresize" rows="3" placeholder="" maxlength="250"></textarea>
                         </div>
                     </div>
                 </div>

                   <button class="btn btn-primary" type="submit" :disabled="isLoading">Guardar</button>
            </form>

         <div class="modal fade " tabindex="-1" role="dialog" id="modal-clonar" data-keyboard="false" data-backdrop="static" >
             <div class="modal-dialog modal-md" role="document">
                 <div class="modal-content">
                     <div class="modal-header">
                       <h4>Clonar Soldadores</h4>
                     </div>
                 <div class="modal-body">
                     <div class="row">
                         <div class="col-md-6 ">
                             <div class="form-group">
                                 <input type="checkbox" id="sel_todos" v-model="sel_todos_clonar" @click="SeleccionarTodosClonar" style="float:left">
                                 <label for="sel_todos" style="float:left;margin-left: 5px;">Seleccionar Todos</label>
                             </div>
                         </div>
                     </div>
                     <div class="row">
                         <div class="col-md-12 ">
                             <div class="form-group">
                                 <div v-for="(elemento,k) in elemento_pasadas" :key="k" >

                                     <div v-if="elemento !=elemento_pasada" class="col-sm-4 col-xs-12">
                                         <input type="checkbox" :id="elemento" :value="elemento"  v-model="elemento_pasadas_a_clonar" style="float:left">
                                         <label :for="elemento" style="float:left;margin-left: 5px;">{{ elemento }}</label>
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                     <button type="button" class="btn btn-primary" @click="ClonarSoldadores">
                         <i v-show="clonando_pasada" class="fa fa-spin fa-refresh"></i> Clonar
                     </button>
                 </div>
                 </div>
             </div>
         </div>


         <div class="modal fade " tabindex="-1" role="dialog" id="modal-Importar-Soldadores" data-keyboard="false" data-backdrop="static" >
             <div class="modal-dialog modal-md" role="document">
                 <div class="modal-content">
                     <div class="modal-header">
                       <h4>Importar Soldadores</h4>
                     </div>
                 <div class="modal-body">
                     <div class="row">
                         <div class="col-md-12" style="margin-top: 15px;">
                             <div class="form-group">
                                 <input style="display: inline;" type="file" multiple="false" id="sheetjs-input" :accept="SheetJSFT"  @change="onchange"/>
                                 <label  v-show="importado_pasadas" class="fa fa-spin fa-refresh" for="sheetjs-input"></label>
                                 <p>Formato soportado : csv</p>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                 </div>
                 </div>
             </div>
         </div>

         <loading
            :active.sync="isLoading"
            :loader="'bars'"
            :color="'red'">
         </loading>

        </div>
        <create-referencias :index="index_referencias" :tabla="tabla" :inputsData="inputsData" @setReferencia="AddReferencia"></create-referencias>
        <clonacion-masiva @actualizarTabla="ClonacionMasiva"></clonacion-masiva>
    </div>
</template>

 <script>

 import uniq from 'lodash/uniq';
 import DatePicker from 'vue2-datepicker';
 import 'vue2-datepicker/index.css';
 import ClonacionMasiva from '../dashboard/informes/clonacion-masiva.vue';
 import { eventModal } from '../../../js/components/event-bus';
import { eventSetReferencia } from '../event-bus';
 import 'vue2-datepicker/locale/es';import {mapState} from 'vuex';
 import Loading from 'vue-loading-overlay';
 import 'vue-loading-overlay/dist/vue-loading.css';
 import moment from 'moment';
 import { toastrInfo,toastrDefault } from '../toastrConfig';
 import {isInt} from '../../functions/isInt.js';
 import {isFloat} from '../../functions/isFloat.js';
 import {sprintf} from '../../functions/sprintf.js'

 export default {

     components: {
       Loading
     },
     props : {
       editmode : {
       type : Boolean,
       required : false,
       default : false
     },
       metodo : {
       type : String,
       required :true
     },
     informe_especialdata: {
        type : String
        },
       otdata : {
       type : Object,
       required : true
       },
       informedata : {
       type : Object,
       required : false,
       default : function () { return {}}
       },
       informe_ridata : {
       type : Object,
       required : false
       },
       materialdata : {
       type : Object,
       required : false
       },
       ot_tipo_soldaduradata : {
        type : [ Object, Array ],
        required : false,
       },
       material2data : {
        type : [ Object, Array ],
        required : false,
       },
        diametrodata : {
            type : [Object,Array],
            required : false,
            },

        diametro_espesordata : {
            type : [Object,Array],
            required : false,
            },
       interno_fuentedata : {
       type : [ Object, Array ],
       required : false
       },
       tecnicadata : {
       type : [ Object ],
       required : false
       },
       interno_equipodata : {
       type : [ Object ],
       required : false
       },
       procedimientodata : {
       type : [ Object ],
       required : false
       },
       tipo_peliculadata : {
       type : [ Object ],
       required : false
       },
       icidata : {
       type : [ Object ],
       required : false
       },
       norma_evaluaciondata : {
       type : [ Object ],
       required : false
       },
       norma_ensayodata : {
       type : [ Object ],
       required : false
       },
       ejecutor_ensayodata : {
       type : [ Object ],
       required : false
       },

       detalledata : {
       type : [ Array ],
       required : false
       },
       pasada_juntas_data : {
       type : [ Array ],
       required : false
       },

      tablamodelos3d_data : {
        type : [ Array ],
        required : false
        },
      tablatramos_data : {
        type : [ Array ],
        required : false
        },
      solicitado_pordata : {
        type : [ Object, Array ],
        required : false
        }
     },
     data() {return {
             errors:[],
             fullPage: false,
             SheetJSFT : [
                 "xlsx", "xlsb", "xlsm", "xls", "xml", "csv", "txt", "ods", "fods", "uos", "sylk", "dif", "dbf", "prn", "qpw", "123", "wb*", "wq*", "html", "htm"
             ].map(function(x) { return "." + x; }).join(","),
            // Formulario encabezado
             reparacion_sn:false,
             obra:'',
             planta:'',
             fecha: moment(new Date()).format('YYYY-MM-DD'),
             numero_inf:'',
             numero_inf_generado:'',
             prefijo:'',
             formato :'',
             componente:'',
             linea:'',
             plano_isom:'',
             hoja:'',
             procedimiento:{},
             observaciones:'',
             index_referencias:'',
             tipo_soldadura:'',
             ot_tipo_soldadura:'',
             ot_tipo_soldaduras_codigo:'',
             ot_obra_tipo_soldaduras_filter:'',
             ot_tipo_soldadura_r:'',
             material:'',
             material2:'',
             material2_tipo:'Accesorio',
             diametro:'',
             solicitado_por:'',
             usuarios_cliente:[],
             espesor:'',
             espesor_chapa:'',
             interno_equipo:'',
             interno_fuente:'',
             kv:'',
             ma:'',
             fuente:'',
             tipo_pelicula:'',
             pantalla:'Pb',
             pos_ant: 0.10,
             pos_pos:0.10,
             lado:'',
             distancia_fuente_pelicula:'',
             norma_evaluacion:'',
             ici:'',
             norma_ensayo:'',
             tecnica:'',
             exposicion:'',
             actividad:'',
             ejecutor_ensayo:'',
             tecnicas_grafico :'',
             tecnica_distancia:'',
             modelo_3d : '',
             TablaModelos3d :[],
            // Fin Formulario encabezado
            // Formulario detalle
             pk:'',
             pasada:0,
             densidad:'',
             junta:'',
             junta_reparacion:'',
             juntas_reparacion:[],
             soldador1:'',
             soldador2:'',
             soldador3:'',
             posicion:'',
             defectoObs:'',
             defectoRiPlanta:'',
             defectoRiGasoducto:'',
             posicionPlacaGosaducto:'',
             defecto_sector:'',
             indexDetalle:-1,
             indexPasada:0,
             //Fin Formulario detalle
             tabla:'',
             isRX:false,
             isChapa:false,
             isGasoducto:false,
             isPerfil:false,
             EnableClonarPasadas:false,
             medida:'',
             equipos:[],
             fuentes:[],
             tipo_peliculas:[],
             icis:[],
             tecnicas:[],
             soldadores:[],
             posiciones:[],
             defectosRiPlanta:[],
             defectosRiGasoducto:[],
             elemento_pasadas:[],
             elemento_pasadas_a_clonar:[],
             elemento_pasada:'',
             TablaDetalle:[],
             TablaPasadas:[],
             junta_posicion_selected : '',
             clonando : false,
             clonando_pasada : false,
             importado_pasadas :  false,
             parseCsv :[],
             TablaImportada :[],
             sel_todos_clonar: false,
             indicaciones_sn : false,
             bola_comparadora: 0.1,
             espesor_tramo: 0.1,
             observacion_tramo: '',
             tramo:'',
             TablaTramos:[],
             resultado_pdf_sn: true,
             appendToBody: false,
             inputsData:{},
             dist_fuente_pel_edit_sn: false,
             proceso_soldadores:'',
             N_Reporte_RFI:'',
             ptt_sn: '',

         }},
     created : function(){

       this.$store.commit('loading', true);
       this.$store.dispatch('loadProcedimietosOtMetodo',
         { 'ot_id' : this.otdata.id, 'metodo' : this.metodo }).then(response =>{
                 if(this.procedimientos.length == 0  ){
                     toastr.options = toastrInfo;
                     toastr.info('No existe ningún procedimiento para el método de ensayo seleccionado');
                     toastr.options = toastrDefault;
                 }
         });
         this.$store.dispatch('loadMateriales');
         this.$store.dispatch('loadDiametros');
         this.$store.dispatch('loadInternoEquipos',{ 'metodo' : this.metodo, 'activo_sn' : 1, 'tipo_penetrante' : 'null' });
         this.getTipoPeliculas();
         this.$store.dispatch('loadNormaEvaluaciones');
         this.$store.dispatch('loadNormaEnsayos');
         this.$store.dispatch('loadModelos3d');
         this.getIcis();
         this.$store.dispatch('loadMedidasPlaca');
         this.getTecnicas();
         this.$store.dispatch('loadEjecutorEnsayo', this.otdata.id);
         this.getSoldadores();
         this.getUsuariosCliente();
         this.getDefectosRiPlanta();
         this.pasada = 1;
         this.formato = 'PLANTA'
         this.setEdit();
     },

     mounted : function() {
          this.getNumeroInforme();
     },
     watch : {
         equipo : function(val) {
            this.isRX = (val.codigo =='RX') ? true : false;
         },
         diametro : function(val) {
            if(val){
                this.isChapa = (val.diametro =='CHAPA') ? true : false;
            }
         },
         formato : function (val) {
            this.isGasoducto =  (val == 'DUCTO') ? true : false;
            this.reparacion_sn = (val == 'PLANTA') ? false : this.reparacion_sn;
            this.isPerfil = (val == 'PERFILES') ? true : false;
            if (this.isGasoducto){
                this.$refs.informeHeader.resetPlanta()
            }
         },
         pasada : function (val){
            this.soldador2 =  (val == '1') ? this.soldador2 : '';
         },
         posicionPlacaGosaducto : function(val){
            if (val != '' && this.formato =='PLANTA'){
            this.defecto_sector = 'RAIZ' ;
            }else if(val == '')  {
            this.defecto_sector = '' ;
            }
         },
         fuentePorInterno: function(val){
            this.fuente = val;
         },
        fecha : function(val) {
            if(this.interno_fuente && this.interno_fuente != '' ){
                this.$store.dispatch('loadCurie',{ 'interno_fuente_id' : this.interno_fuente.id, 'fecha_final': this.fecha_mysql }).then(() => {
                    this.actividad = this.curie;
                });
            }
         },
     },
     computed :{

         ...mapState(['isLoading','url','ot_obra_tipo_soldaduras','materiales','diametros','espesores','procedimientos','norma_evaluaciones','norma_ensayos','ejecutor_ensayos','interno_equipos','fuentePorInterno','curie','modelos_3d','medidas_placa']),

            HabilitarClonarPasadas(){

                this.EnableClonarPasadas = (this.isGasoducto && this.pasada=='1' && this.TablaDetalle.length);

            },

            fecha_mysql : function(){

                return moment(this.fecha).format('YYYY-MM-DD HH:mm:ss');

            },

            numero_inf_code : function()  {
                if(this.numero_inf){
                    if(this.informedata.numero_repetido){
                        if(this.informedata.numero_repetido !== 1){
                            return this.metodo +  sprintf("%04d",this.numero_inf) + '-' + this.informedata.numero_repetido;
                        } else {
                            return this.metodo +  sprintf("%04d",this.numero_inf);
                        }
                    } else
                   return this.metodo +  sprintf("%04d",this.numero_inf);
                }
             },

             ot_tipo_soldaduras_filter_R :function(){

                let aux = [];
                aux = this.ot_obra_tipo_soldaduras.map(item=> item.tipo_soldadura);

                const result = [];
                const map = new Map();
                for (const item of aux) {
                    if(!map.has(item.id)){
                        map.set(item.id, true);
                            result.push({
                            id: item.id,
                            codigo: item.codigo
                        });
                    }
                }
                return result.filter(item => item.codigo != 'R') ;

             },

             ot_tipo_soldaduras_filter_codigo : function() {
                if(this.isGasoducto)
                    return this.ot_obra_tipo_soldaduras.filter(item => item.tipo_soldadura.codigo == this.tipo_soldadura.codigo)
                else
                    return this.ot_obra_tipo_soldaduras.filter(item => item.tipo_soldadura.codigo != 'R')
             },

      },
     methods : {
         setEdit : function(){
             if(this.editmode) {
                this.formato = this.informe_ridata.gasoducto_sn ? 'DUCTO' : (this.informe_ridata.perfil_sn ? 'PERFILES' : 'PLANTA');
                this.obra = this.informedata.obra;
                this.planta = this.informedata.planta;
                this.fecha   = this.informedata.fecha;
                this.pk = this.informedata.km;
                this.ot_tipo_soldadura = this.ot_tipo_soldaduradata;
                this.tipo_soldadura = this.ot_tipo_soldaduradata.tipo_soldadura;
                this.numero_inf = this.informedata.numero;
                this.componente = this.informedata.componente;
                this.material = this.materialdata;
                this.material2 = this.material2data;
                if(this.informedata.material2_tipo) { this.material2_tipo = this.informedata.material2_tipo };
                this.linea = this.informedata.linea;
                this.plano_isom = this.informedata.plano_isom;
                this.hoja = this.informedata.hoja;
                this.diametro = (this.diametro_espesordata['id'] !== 'undefined' && !(this.diametro_espesordata instanceof  Array)) ? this.diametro_espesordata : { 'diametro' : this.informedata.diametro_especifico };
                this.espesor = this.informedata.espesor_especifico ? {'espesor' : this.informedata.espesor_especifico} : this.diametro_espesordata;
                if (!(this.diametrodata instanceof  Array)) {
                    this.getEspesores(this.diametrodata.diametro_code);
                    Object.defineProperty(this.diametro,'diametro_code',{ value: this.diametrodata.diametro_code})
                }
                console.log('Diametro..', this.diametro)
                this.tecnica = this.tecnicadata;
                this.interno_equipo = this.interno_equipodata;
                this.interno_fuente = this.interno_fuentedata ;
                this.kv = this.informe_ridata.kv;
                this.ma = this.informe_ridata.ma;
                this.fuente = this.interno_fuentedata.fuente ? this.interno_fuentedata.fuente : '' ;
                this.procedimiento = this.procedimientodata;
                this.ici = this.icidata;
                this.norma_evaluacion = this.norma_evaluaciondata;
                this.norma_ensayo = this.norma_ensayodata;
                this.tipo_pelicula = this.tipo_peliculadata;
                this.medida = { codigo : this.informe_ridata.medida };
                this.espesor_chapa = this.informedata.espesor_chapa;
                this.pos_ant = this.informe_ridata.pos_ant;
                this.pos_pos = this.informe_ridata.pos_pos;
                this.lado = this.informe_ridata.lado;
                this.exposicion = this.informe_ridata.exposicion;
                this.distancia_fuente_pelicula = this.informe_ridata.distancia_fuente_pelicula;
                this.ejecutor_ensayo = this.ejecutor_ensayodata;
                this.TablaDetalle = this.detalledata,
                this.TablaPasadas = this.pasada_juntas_data;
                this.InicializarElementosPasadas();
                this.observaciones = this.informedata.observaciones
                this.TablaModelos3d = this.tablamodelos3d_data;
                this.solicitado_por = this.solicitado_pordata ;
                this.TablaTramos = this.tablatramos_data;
                this.resultado_pdf_sn = this.informe_ridata.resultado_pdf_sn;
                

                if(this.informe_ridata.reparacion_sn){
                     this.getElementosReparacion();
                }

                if (typeof(this.interno_fuentedata.id) !== 'undefined'){
                    this.$store.dispatch('loadCurie', { 'interno_fuente_id' : this.interno_fuentedata.id, 'fecha_final': this.informedata.fecha }).then(response => {
                          this.actividad = this.curie;
                    });
                }

                    if (this.editmode && this.informe_ridata) {
                    this.N_Reporte_RFI = this.informe_ridata.N_Reporte_RFI || '';
                    this.ptt_sn = this.informe_ridata.ptt_sn || false;
                }

                    this.$store.dispatch('loadOtObraTipoSoldaduras',{ 'ot_id' : this.otdata.id, 'obra' : this.informedata.obra }).then(res => {

                        this.reparacion_sn = this.informe_ridata.reparacion_sn == 1 ?  true : false;

                    });

                    }
            },

         cambioReparacion_sn : function(){

            this.ot_tipo_soldadura='';
            this.TablaDetalle = [];
            this.TablaPasadas = [];
            this.TablaImportada= [];
            this.juntas_reparacion  =[];
            this.junta_reparacion ='';
            this.getElementosReparacion();
         },
         cambioPtt_sn() {
                // Cambiar entre false y true directamente en data
                this.ptt_sn = !this.ptt_sn ? 1 : 0;
            },

         setObra: function(value){
            this.obra = value;
            this.ot_tipo_soldadura='';
            if(this.obra){
                this.$store.dispatch('loadOtObraTipoSoldaduras',{ 'ot_id' : this.otdata.id, 'obra' : this.obra });
            }
        },
        setPlanta: function(value){
            this.planta = value;
        },
        cambiopTipoInforme: function() {
            this.pk ='' ;
            this.tipo_soldadura='';
            this.reparacion_sn= false;
            this.cambioOtTipoSoldadura();
            this.resetDetalle();
         },

         cambioOtTipoSoldadura() {
            this.ot_tipo_soldadura = '';
         },

         async getElementosReparacion() {
            this.$store.commit('loading', true);
             axios.defaults.baseURL = this.url ;
             let urlRegistros = 'informes_ri/elementos_reparacion/ot/' + this.otdata.id +  '/obra/' + (this.obra ? this.obra.replace('/','--') :'null') + '/km/' + (this.pk ? this.pk : 'null') + '/linea/' + (this.linea ? this.linea.replace('/','--') :'null') + '/plano_isom/' + (this.plano_isom ? this.plano_isom.replace('/','--') : 'null') + '/hoja/' + (this.hoja ? this.hoja.replace('/','--') : 'null') + '?api_token=' + Laravel.user.api_token;

             await axios.get(urlRegistros).then(response =>{
                this.juntas_reparacion = response.data
            });
            this.$store.commit('loading', false);
         },

         getNumeroInforme:function() {
             if(!this.editmode) {
                 axios.defaults.baseURL = this.url ;
                var urlRegistros = 'informes/ot/' + this.otdata.id + '/metodo/' + this.metodo + '/tecnica/0' + '/generar-numero-informe/'  + '?api_token=' + Laravel.user.api_token;
                axios.get(urlRegistros).then(response =>{
                 this.numero_inf = response.data

                 });
              }
         },

        changeDiametro: function(diametro) {
            if(diametro.diametro != 'CHAPA')   {
                this.espesor_chapa = '';
            }

            if(diametro.diametro == 'CHAPA')   {
                this.tecnica = this.tecnicas[this.tecnicas.findIndex(elemento =>elemento.codigo == 'CHAPA')];
                    if(!this.isLoading){
                        this.ActualizarDistFuentePelicula();
                    }
            }

            if(!this.Loading) {
                let index = this.diametros.findIndex(e => e.diametro_code === diametro.diametro_code);
                this.espesor='';
                this.distancia_fuente_pelicula='';
                if ( index !== -1) {
                    this.dist_fuente_pel_edit_sn = false;
                    if(diametro){
                        this.$store.commit('loading', true);
                        this.$store.dispatch('loadEspesores',diametro.diametro_code).then(() =>{
                                this.$store.commit('loading', false);
                        });
                    }
                }

                if (index === -1) {
                    this.dist_fuente_pel_edit_sn = true;
                    if(diametro){
                        if(!this.validarDiametroEspecifico(diametro)){
                            this.diametro = {}
                        }
                    }
                }
            }
        },

        getEspesores : function(diametro_code) {
            this.$store.commit('loading', true);
            this.$store.dispatch('loadEspesores', diametro_code).then(() =>{
                this.$store.commit('loading', false);
            });
        },

        validarDiametroEspecifico : function(diametro){
            let exp_posicion = /^[0-9]{0,3}.[0-9]{0,2}m$/;
            return (exp_posicion.test(this.diametro.diametro))
        },

         getFuente : function(){

             if(this.interno_equipo.interno_fuente){
                this.interno_fuente = this.interno_equipo.interno_fuente;
                this.$store.dispatch('loadFuentePorInterno',this.interno_equipo.interno_fuente.id).then( () => {
                    this.fuente = this.fuentePorInterno;
                    this.ActualizarDistFuentePelicula();
                });
                if(this.fuentePorInterno) {
                     this.$store.dispatch('loadCurie',{ 'interno_fuente_id' : this.interno_equipo.interno_fuente.id, 'fecha_final': this.fecha_mysql }).then(response => {

                         this.actividad = this.curie;

                     });
             }

             }else{
                this.interno_fuente = '' ;
                this.fuente ='';
                this.actividad = '';
                this.ActualizarDistFuentePelicula();
             }
             this.resetInputsEquipos();
         },
        getUsuariosCliente : function(){

            axios.defaults.baseURL = this.url ;
            var urlRegistros = 'users/ot_id/' + this.otdata.id + '?api_token=' + Laravel.user.api_token;
            axios.get(urlRegistros).then(response =>{
            this.usuarios_cliente = response.data
            });

        },
         resetInputsEquipos : function() {

             this.kv = this.interno_equipo.voltaje;
             this.ma = this.interno_equipo.amperaje;
         },
         getTipoPeliculas : function(){
             axios.defaults.baseURL = this.url ;
                 var urlRegistros = 'tipo_peliculas' + '?api_token=' + Laravel.user.api_token;
                 axios.get(urlRegistros).then(response =>{
                 this.tipo_peliculas = response.data

                 });
         },
         getIcis: function(){

                 axios.defaults.baseURL = this.url ;
                 var urlRegistros = 'icis' + '?api_token=' + Laravel.user.api_token;
                 axios.get(urlRegistros).then(response =>{
                 this.icis = response.data
                 });
               },
         getTecnicas: function(){

                 axios.defaults.baseURL = this.url ;
                 var urlRegistros = 'tecnicas/metodo/'+ this.metodo + '?api_token=' + Laravel.user.api_token;
                 axios.get(urlRegistros).then(response =>{
                 this.tecnicas = response.data
                 });
               },
         cambioEspesor : function(){

             if(this.espesor.id != undefined) {
                  this.ActualizarDistFuentePelicula();
             }else{
              var match = this.espesor.espesor.match(/^[+]?([0-9]+[.])?[0-9]+?$/);
              if(!match){
                  this.espesor.espesor = 0;
                }
                 this.ActualizarDistFuentePelicula();
             }
         },

         cambioMedida : function(){

             if(this.medida.id == undefined) {
                this.medida.codigo = this.medida.codigo.replace('X','x');
                this.medida.codigo = this.medida.codigo.replace('-','x');
                let existe_alto = this.medida.codigo.includes('x');
                if(!existe_alto){
                    this.medida.codigo = '7 x ' + this.medida.codigo;
                }else{
                    this.medida.codigo = this.medida.codigo.replace('x',' x ');
                }

            }else if(this.espesor.espesor != undefined){
                var match = this.espesor.espesor.match(/[+]?([0-9]+?[xX-]{1})?[0-9]+?$/);
                if(!match){
                    this.espesor.espesor = 0;
                }
             }

            this.ActualizarDistFuentePelicula();
         },

         ActualizarDistFuentePelicula : function() {

            axios.defaults.baseURL = this.url ;
            let foco = (this.interno_fuente) ? this.interno_fuente.foco : this.interno_equipo.foco ;
                foco = foco ? foco : 0;
            if(this.tecnica.codigo == 'CHAPA'){
                if(this.tecnica &&  this.medida){
                    this.$store.commit('loading', true);
                    var urlRegistros = 'tecnica_distancias/tecnica/' + this.tecnica.id + '/medida/'+ this.medida.codigo + '?api_token=' + Laravel.user.api_token;
                    axios.get(urlRegistros).then(response =>{
                        this.tecnica_distancia = response.data
                        this.distancia_fuente_pelicula=this.tecnica_distancia[0].valor;

                    }).finally(() => { this.$store.commit('loading', false); });
                }
            }else{
                if(this.tecnica && this.diametro && this.espesor){
                    this.$store.commit('loading', true);
                    var urlRegistros = 'tecnica_distancias/tecnica/' + this.tecnica.id + '/diametro/'+ this.diametro.diametro_code + '/espesor/' + this.espesor.espesor + '/foco/' + foco + '?api_token=' + Laravel.user.api_token;
                    axios.get(urlRegistros).then(response =>{
                        this.tecnica_distancia = response.data
                        this.distancia_fuente_pelicula=this.tecnica_distancia[0].valor;
                    }).finally(() => { this.$store.commit('loading', false); });
                }
            }
         },

         getEjecutorEnsayo: function() {
                 axios.defaults.baseURL = this.url ;
                 var urlRegistros = 'ot-operarios/ot/' + this.otdata.id + '?api_token=' + Laravel.user.api_token;
                 axios.get(urlRegistros).then(response =>{
                 this.ejecutor_ensayos = response.data
                 });
        },

        resetDetalle : function(){
            this.TablaDetalle = [];
            this.TablaPasadas = [];
            this.TablaImportada= [];
            this.elemento_pasadas=[];
            this.elemento_pasada='';
            this.pk = '';
            this.tipo_soldadura='';
            this.pasada='';
            this.junta='';
            this.soldador1='',
            this.soldador2='',
            this.soldador3='',
            this.posicion='',
            this.posicionPlacaGosaducto='',
            this.proceso_soldadores=""
         },
         //detalle
         async getSoldadores(){
                axios.defaults.baseURL = this.url ;
                var urlRegistros = 'ot_soldadores/ot/' + this.otdata.id + '?api_token=' + Laravel.user.api_token;
                await axios.get(urlRegistros).then(response =>{
                this.soldadores = response.data
                });

         },
         getDefectosRiPlanta : function(){
                 axios.defaults.baseURL = this.url ;
                 var urlRegistros = 'defectos_ri/planta/' + '?api_token=' + Laravel.user.api_token;
                 axios.get(urlRegistros).then(response =>{
                 this.defectosRiPlanta = response.data
             }).finally(res => { this.$store.commit('loading', false); });

         },
         getDefectosRiGasoducto : function(){
                axios.defaults.baseURL = this.url ;
                var urlRegistros = 'defectos_ri/gasoducto/' + '?api_token=' + Laravel.user.api_token;
                axios.get(urlRegistros).then(response =>{
                this.defectosRiGasoducto = response.data
                });

         },
         selectPosDetalle :function(index){
            this.indicaciones_sn = true;
            this.indexDetalle = index ;
            this.pasada =1 ;

         },
         InicializarElementosPasadas : function(){
            this.detalledata.forEach(function(item) {
                this.addElementosPasadas(item.junta);
            }.bind(this));
         },

         AddDetalle (posicion, densidad) {

             var match = this.posicion.match(/^([0-9]{1,4}[-][0-9]{1,4})$|^([a-zA-Z]{1})$|^(GAP){3}$/);
              if(!match && this.posicion != 'GAP' && this.clonando == false){
                  toastr.error('Ingrese un rango separado por un guion o una letra','Formato inválido');
                  return;
                }

             if( (this.reparacion_sn && this.junta_reparacion == '') ||(!this.reparacion_sn && this.junta == '') ){
                toastr.error('Campo Elemento es obligatorio');
                return;
             }else if(this.posicion == '' && this.clonando == false) {
                toastr.error('Campo posición es obligatorio');
                return;
             }else if (this.densidad == '' && this.clonando == false){
                toastr.error('Campo densidad es obligatorio');
                return;
             }

             let aux_junta = this.reparacion_sn ? this.junta_reparacion.codigo + 'R' :  this.junta;
             this.addElementosPasadas(aux_junta);
             this.TablaDetalle.push({
                junta: aux_junta,
                densidad : (typeof(densidad) !== 'undefined') ? densidad : this.densidad,
                posicion : (typeof(posicion) !== 'undefined') ? posicion : this.posicion,
                aceptable_sn : 1 ,
                observacion : '',
                defectos : []
             });

         },
         addElementosPasadas : function(aux_junta){
            let index = this.elemento_pasadas.findIndex(elemento => elemento == aux_junta);
            if(index == -1){
            this.elemento_pasadas.push(aux_junta);
            }
         },
         autocompletarNumeroPasada : function(){
             let cant_pasadas =  this.contarPasadaElemento(this.elemento_pasada);
             this.pasada = cant_pasadas + 1 ;
         },

         contarPasadaElemento: function(elemento){
             let cant = 0;
             this.TablaPasadas.forEach(function(item){
                 if(elemento == item.elemento_pasada){
                    cant++;
                 }
             }.bind(this));
             return cant;
         },
         AddPasadas() {
            if (this.elemento_pasada == '') {
                toastr.error('Error: El elemento es obligatorio para ingresar la/s pasadas');
                return;
            }
            let cant_pasadas = this.contarPasadaElemento(this.elemento_pasada);
            if (this.formato == 'PLANTA') {
                console.log(this.informe_especialdata);
                if (this.informe_especialdata != '' && cant_pasadas >= 5) {
                    toastr.error('Error: Formato PLANTA con informe especial acepta hasta 4 pasadas');
                    return;
                } else if (this.informe_especialdata == null && cant_pasadas >= 1) {
                    toastr.error('Error: Formato PLANTA acepta solo 1 pasada');
                    return;
                }
            }
            if (this.formato == 'DUCTO') {
                if (cant_pasadas >= 12) {
                    toastr.error('Error: Formato DUCTO acepta 12 pasadas');
                    return;
                }
            }

            // Verificar si ya existe el proceso_soldadores en el elemento actual
                let procesoExistente = this.TablaPasadas.find(pasada => 
                pasada.elemento_pasada === this.elemento_pasada && 
                pasada.proceso_soldadores === this.proceso_soldadores);

            if (procesoExistente) {
                toastr.error('Error: El proceso seleccionado ya existe para el elemento actual');
                return;
            }

            if (this.soldador1) {
                this.TablaPasadas.push({
                    elemento_pasada: this.elemento_pasada,
                    pasada: this.pasada,
                    soldador1: this.soldador1,
                    soldador2: this.soldador2,
                    soldador3: this.soldador3,
                    proceso_soldadores: this.proceso_soldadores,
                });

                if (this.isGasoducto) {
                    if (this.pasada < 12)
                        this.pasada++;
                    else if (this.pasada == 12)
                        this.pasada = 1;
                }
            } else {
                toastr.error('Campo Cuño Z es obligatorio');
            }
        },
         AddTramos () {
            if(this.tramo == ''){
               toastr.error('Error :El tramo es obligatorio');
               return;
            }
            if(this.bola_comparadora == 0){
               toastr.error('Error :El campo bola comparadora es obligatorio');
               return;
            }
            if(this.espesor == 0){
                toastr.error('Error :El espesor es obligatorio');
                return;
            }
            this.TablaTramos.push({
                    tramo : this.tramo,
                    bola_comparadora : this.bola_comparadora,
                    espesor_tramo: this.espesor_tramo,
                    espesor_real: (((this.espesor_tramo)*(25.4))/this.bola_comparadora).toFixed(2),
                    observacion_tramo : this.observacion_tramo,
                    observaciones:null,
                    path1:null,
                    path2:null,
                    path3:null,
                    path4:null
            });
         },
         addDefectos () {

             if(this.defectoRiPlanta == '' ){
                  toastr.error('Campo defecto es obligatorio');
                  return;
             }

             if(this.posicionPlacaGosaducto !=''){

                let str_pos_placa = this.TablaDetalle[this.indexDetalle].posicion;
                if (this.posicionPlacaGosaducto == 'GAP') {

                    if (this.posicionPlacaGosaducto !== str_pos_placa) {
                        toastr.error('Valores en posición indicación incorrectos');
                        return;
                    }
                }else if (str_pos_placa.length == 1){

                    if (this.posicionPlacaGosaducto.length > 1 || str_pos_placa != this.posicionPlacaGosaducto){

                       toastr.error('Valores en posición indicación incorrectos');
                       return;
                    }

                }else{

                    let exp_posicion = /^[0-9]{1,3}-[0-9]{1,3}$/ ;
                    if(!exp_posicion.test(this.posicionPlacaGosaducto)){
                        toastr.error('El formato ingresado no es válido');
                        return;
                    }

                    let str_pos_defecto = this.posicionPlacaGosaducto.split("-");
                    let pos_inicial_defecto = parseInt(str_pos_defecto[0].trim());
                    let pos_final_defecto = parseInt(str_pos_defecto[1].trim());

                    if ((pos_final_defecto <  pos_inicial_defecto) && (pos_inicial_defecto > 0 && pos_final_defecto != 0)){
                        toastr.error('Valores en posición indicación incorrectos');
                        return;
                    }

                    let array_pos_placa = this.TablaDetalle[this.indexDetalle].posicion.split("-");
                    let pos_inicial_placa = parseInt(array_pos_placa[0].trim());
                    let pos_final_placa = parseInt(array_pos_placa[1].trim());
                    let longitud_placa = Math.abs(parseInt(this.TablaDetalle[0].posicion.split("-")[1].trim()) - parseInt(this.TablaDetalle[0].posicion.split("-")[0].trim()));

                    if(! ( ((pos_inicial_defecto >= pos_inicial_placa && (pos_final_defecto <= (pos_inicial_placa + longitud_placa))) || ((pos_inicial_defecto == pos_inicial_placa) && (pos_final_defecto == pos_final_placa ))))) {
                        toastr.error('Valores en posición indicación incorrectos');
                        return;
                    }
                }
             }

             if(this.posicionPlacaGosaducto !='' &&  this.formato=='DUCTO' && !this.defecto_sector){
                toastr.error('El campo pasada es obligatorio si existe posicion indicación');
                return;
             }

             this.TablaDetalle[this.indexDetalle].defectos.push({

                codigo: this.defectoRiPlanta.codigo,
                pasada: this.posicionPlacaGosaducto !='' ? this.defecto_sector : '',
                descripcion: this.defectoRiPlanta.descripcion,
                id : this.defectoRiPlanta.id,
                posicion : this.posicionPlacaGosaducto,

            });

             if(this.posicionPlacaGosaducto != ''){
                this.TablaDetalle[this.indexDetalle].aceptable_sn = false;
             }

            this.defectoRiPlanta='';
            this.posicionPlacaGosaducto='';
            this.defecto_sector='';

          },
         RemoveDetalle(index) {
            this.indexDetalle = 0;
            let junta = this.TablaDetalle[index].junta;
            this.TablaDetalle.splice(index, 1);
            if(this.TablaDetalle.findIndex(elemento => elemento.junta == junta) == -1){

                this.TablaPasadas = this.TablaPasadas.filter(function(item){

                    return  item.elemento_pasada != junta;

                 });

             this.elemento_pasada = '';
             this.elemento_pasadas = this.elemento_pasadas.filter(function(item2){

                 return  item2 != junta;
             });

            }
         },
         RemovePasada(index) {
            this.indexPasada = 0;
            this.TablaPasadas.splice(index, 1);
            this.autocompletarNumeroPasada();
         },
         OpenReferencias(event,index,tabla,inputsReferencia){
             console.log("hola")
             this.index_referencias = index ;
             this.tabla = tabla;
             this.inputsData = inputsReferencia ;
             eventSetReferencia.$emit('open');
         },
         AddReferencia(Ref){

             this.TablaTramos[this.index_referencias].observaciones = Ref.observaciones;
             this.TablaTramos[this.index_referencias].path1 = Ref.path1;
             this.TablaTramos[this.index_referencias].path2 = Ref.path2;
             this.TablaTramos[this.index_referencias].path3 = Ref.path3;
             this.TablaTramos[this.index_referencias].path4 = Ref.path4;

             $('#nuevo').modal('hide');
         },
             RemoveDefectos(index) {

             this.TablaDetalle[this.indexDetalle].defectos.splice(index, 1);
             let aceptable = true;
             this.TablaDetalle[this.indexDetalle].defectos.forEach(function(defecto){
                 if(defecto.posicion !=''){
                    aceptable = false;
                 }
             })
             this.TablaDetalle[this.indexDetalle].aceptable_sn = aceptable;
         },
        RemoveTramos(index) {
             this.TablaTramos.splice(index, 1);
         },
         ClonacionMasiva ($desde,$hasta) {
            while($desde <= $hasta){
                this.junta = $desde
                this.ClonarPosPlanta()
                $desde++
            }
         },
         OpenClonacionMasiva : function(){
            eventModal.$emit('open_clonacion_masiva');
         },
         ClonarPosPlanta : function(){
             this.clonando = true;
             if(this.TablaDetalle.length > 0){
                 let TablaDetalleReverse =  JSON.parse(JSON.stringify(this.TablaDetalle));
                 let x = TablaDetalleReverse.length-1;
                 let juntaAux = TablaDetalleReverse[x].junta;
                 let posicionJunta =[];
                 while (  (x >= 0)  && (juntaAux == TablaDetalleReverse[x].junta)) {
                     posicionJunta.unshift(TablaDetalleReverse[x]);
                     x = x - 1;
                 }
                 posicionJunta.forEach(function(pos) {
                 this.AddDetalle(pos.posicion,pos.densidad);
                 }.bind(this));
             }
             this.clonando = false;
         },
         SeleccionarTodosClonar: function(){
             this.elemento_pasadas_a_clonar = [];
             if(!this.sel_todos_clonar){
                 this.elemento_pasadas.forEach(function(item){

                     if(item != this.elemento_pasada){
                         this.elemento_pasadas_a_clonar.push(item);
                     }

                 }.bind(this));
             }
         },
         ModalClonarSoldadores: function(){

            this.elemento_pasadas_a_clonar = [];
            this.sel_todos_clonar = false;
            if(this.elemento_pasada){
                $('#modal-clonar').modal('show');
            }
         },

         ModalImportarSoldadores : function(){

             document.getElementById("sheetjs-input").value = "";
             $('#modal-Importar-Soldadores').modal('show');
         },

         selectPosPasadas : function(index){
             this.indexPasada = index ;
         },
         ClonarSoldadores : function(){
             this.clonando_pasada = true;
             /* Borro las pasadas de los elementos seleccionados que vamos a clonar*/
             this.elemento_pasadas_a_clonar.forEach(function(item_a_clonar){
                this.TablaPasadas = this.TablaPasadas.filter(function(item_tabla_pasada){
                   return  item_tabla_pasada.elemento_pasada != item_a_clonar;
                 })
             }.bind(this))
             let TablaAClonar = [];
             this.TablaPasadas.forEach(function(item){
                 if(item.elemento_pasada == this.elemento_pasada){
                     TablaAClonar.push(item);
                 }
             }.bind(this))
             this.elemento_pasadas_a_clonar.forEach(function(item_a_clonar){
                  TablaAClonar.forEach(function(item){

                     this.TablaPasadas.push({
                         elemento_pasada : item_a_clonar,
                         pasada : item.pasada,
                         soldador1 :  item.soldador1,
                         soldador2 :  item.soldador2,
                         soldador3 :  item.soldador3,
                         proceso_soldadores: item.proceso_soldadores

                     });
                 }.bind(this))
             }.bind(this))
            this.clonando_pasada = false;
            $('#modal-clonar').modal('hide');
         },
         onchange: function(evt) {
             this.importado_pasadas = true;
             var file;
             var files = evt.target.files;
             if (!files || files.length == 0) return;
             file = files[0];
             var reader = new FileReader();
             reader.onload = function (e) {

                 var binary = "";
                 var bytes = new Uint8Array(e.target.result);
                 var length = bytes.byteLength;
                 for (var i = 0; i < length; i++) {
                     binary += String.fromCharCode(bytes[i]);
                 }
                 var wb = XLSX.read(binary, {type: 'binary'});
                 var wsname = wb.SheetNames[0];
                 var ws = wb.Sheets[wsname];
                 var ws_f = wb.Sheets[wsname];
                 this.TablaImportada = XLSX.utils.sheet_to_json(ws_f,{header:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],defval:''});
                 this.TablaPasadas = [];
                 this.copiarImportacion();

             }.bind(this);
             reader.readAsArrayBuffer(file);

         },

         async  StoreSoldadores(){
             let soldadores_importados = [];
             this.TablaImportada.forEach(function(item,index){
                 if(index > 2){
                     if((item['1'] == this.pk) && (this.elemento_pasadas.findIndex(elemento => elemento == item['2'])!= -1 ) && (item['3']==this.ot_tipo_soldadura.codigo)){
                         soldadores_importados.push(item['4']);
                         soldadores_importados.push(item['5']);
                         soldadores_importados.push(item['6']);
                         soldadores_importados.push(item['7']);
                         soldadores_importados.push(item['8']);
                         soldadores_importados.push(item['9']);
                         soldadores_importados.push(item['10']);
                         soldadores_importados.push(item['11']);
                         soldadores_importados.push(item['12']);
                         soldadores_importados.push(item['13']);
                         soldadores_importados.push(item['14']);
                         soldadores_importados.push(item['15']);
                         soldadores_importados.push(item['16']);
                     }
                 }
             }.bind(this));
             axios.defaults.baseURL = this.url ;
             var urlRegistros = 'ot_soldadores/insertar_importados/ot/' + this.otdata.id + '/cliente/' + this.otdata.cliente_id + '?api_token=' + Laravel.user.api_token;

             try{
                 let res = await axios.post(urlRegistros,{

                    'soldadores_importados' : soldadores_importados,

                 });
                 return true;

             } catch (error){
                toastr.error('Ocurrio un error al importar los soldadores');
                return false;
             }

         },
         async copiarImportacion(){
           let resul_store_soldadores =  await this.StoreSoldadores();
           if(resul_store_soldadores) {
                 await this.getSoldadores();
                 this.TablaImportada.forEach(function(item,index){

                     if(index > 2){
                             if((item['1'] == this.pk) && (this.elemento_pasadas.findIndex(elemento => elemento == item['2'])!= -1 ) && (item['3']==this.ot_tipo_soldadura.codigo)){
                                 let index_soldador1_p1 = this.soldadores.findIndex(elemento => elemento.codigo == item['4']);
                                 let index_soldador2_p1 = this.soldadores.findIndex(elemento => elemento.codigo == item['5']);
                                 let index_soldador3_p1 = this.soldadores.findIndex(elemento => elemento.codigo == item['6']);
                                 let index_soldador1_p2 = this.soldadores.findIndex(elemento => elemento.codigo == item['7']);
                                 let index_soldador3_p2 = this.soldadores.findIndex(elemento => elemento.codigo == item['8']);
                                 let index_soldador1_p3 = this.soldadores.findIndex(elemento => elemento.codigo == item['9']);
                                 let index_soldador3_p3 = this.soldadores.findIndex(elemento => elemento.codigo == item['10']);
                                 let index_soldador1_p4 = this.soldadores.findIndex(elemento => elemento.codigo == item['11']);
                                 let index_soldador3_p4 = this.soldadores.findIndex(elemento => elemento.codigo == item['12']);
                                 let index_soldador1_p5 = this.soldadores.findIndex(elemento => elemento.codigo == item['13']);
                                 let index_soldador3_p5 = this.soldadores.findIndex(elemento => elemento.codigo == item['14']);
                                 let index_soldador1_p6 = this.soldadores.findIndex(elemento => elemento.codigo == item['15']);
                                 let index_soldador3_p6 = this.soldadores.findIndex(elemento => elemento.codigo == item['16']);
                                 /*Pasada 1 */
                                 if(item['4']!=''){
                                     let aux_soldador1 = (index_soldador1_p1 != -1) ? this.soldadores[index_soldador1_p1] : '';
                                     let aux_soldador2 = (index_soldador2_p1 != -1) ? this.soldadores[index_soldador2_p1] : '';
                                     let aux_soldador3 = (index_soldador3_p1 != -1) ? this.soldadores[index_soldador3_p1] : '';
                                     this.TablaPasadas.push({

                                         elemento_pasada :item['2'],
                                         pasada : 1,
                                         soldador1 :  aux_soldador1,
                                         soldador2 :  aux_soldador2,
                                         soldador3 :  aux_soldador3,
                                     });
                                     /*Pasada 2 */
                                     if(item['7']!=''){
                                             aux_soldador1 = (index_soldador1_p2 != -1) ? this.soldadores[index_soldador1_p2] : '';
                                             aux_soldador3 = (index_soldador3_p2 != -1) ? this.soldadores[index_soldador3_p2] : '';
                                             this.TablaPasadas.push({

                                                 elemento_pasada :item['2'],
                                                 pasada : 2,
                                                 soldador1 :  aux_soldador1,
                                                 soldador2 :  '',
                                                 soldador3 :  aux_soldador3,
                                             });

                                             /*Pasada 3 */
                                             if(item['9']!=''){
                                                     aux_soldador1 = (index_soldador1_p3 != -1) ? this.soldadores[index_soldador1_p3] : '';
                                                     aux_soldador3 = (index_soldador3_p3 != -1) ? this.soldadores[index_soldador3_p3] : '';
                                                     this.TablaPasadas.push({

                                                         elemento_pasada :item['2'],
                                                         pasada : 3,
                                                         soldador1 :  aux_soldador1,
                                                         soldador2 :  '',
                                                         soldador3 :  aux_soldador3,
                                                     });
                                             }
                                                 /*Pasada 4 */
                                                 if(item['11']!=''){
                                                         aux_soldador1 = (index_soldador1_p4 != -1) ? this.soldadores[index_soldador1_p4] : '';
                                                         aux_soldador3 = (index_soldador3_p4 != -1) ? this.soldadores[index_soldador3_p4] : '';
                                                         this.TablaPasadas.push({

                                                             elemento_pasada :item['2'],
                                                             pasada : 4,
                                                             soldador1 :  aux_soldador1,
                                                             soldador2 :  '',
                                                             soldador3 :  aux_soldador3,
                                                         });
                                                 }
                                                 /*Pasada 5 */
                                                 if(item['13']!=''){
                                                         aux_soldador1 = (index_soldador1_p5 != -1) ? this.soldadores[index_soldador1_p5] : '';
                                                         aux_soldador3 = (index_soldador3_p5 != -1) ? this.soldadores[index_soldador3_p5] : '';
                                                         this.TablaPasadas.push({

                                                             elemento_pasada :item['2'],
                                                             pasada : 5,
                                                             soldador1 :  aux_soldador1,
                                                             soldador2 :  '',
                                                             soldador3 :  aux_soldador3,
                                                         });
                                                 }
                                                     /*Pasada 6 */
                                                     if(item['15']!=''){
                                                             aux_soldador1 = (index_soldador1_p6 != -1) ? this.soldadores[index_soldador1_p6] : '';
                                                             aux_soldador3 = (index_soldador3_p6 != -1) ? this.soldadores[index_soldador3_p6] : '';
                                                             this.TablaPasadas.push({

                                                                 elemento_pasada :item['2'],
                                                                 pasada : 6,
                                                                 soldador1 :  aux_soldador1,
                                                                 soldador2 :  '',
                                                                 soldador3 :  aux_soldador3,
                                                             });
                                                     }
                                     }
                                 }
                             }
                     }
                 }.bind(this))

                 if(this.elemento_pasadas.length > 0){

                     this.elemento_pasada = this.elemento_pasadas[0];
                 }
                 toastr.info('Los soldadores no encontrados fueron agregados al sistema automaticamente.');
                 $('#modal-Importar-Soldadores').modal('hide');
           }
           this.importado_pasadas = false;
         },

         addModelo : function(){

             this.TablaModelos3d.push({

                ...this.modelo_3d,

             });

         },

         RemoveModelo : function(index){

            this.TablaModelos3d.splice(index, 1);
            this.modelo_3d = '';

         },

         Store : function(){
                     this.errors =[];
                     let gasoducto_sn ;
                     if(this.formato =='DUCTO')
                         gasoducto_sn = true;
                     else if(this.formato =='PLANTA' || this.formato == 'PERFILES')
                         gasoducto_sn = false;
                     else
                         gasoducto_sn= null;
                     let perfil_sn ;
                     if(this.formato == 'PERFILES')
                        perfil_sn = true;
                     else if(this.formato =='PLANTA' || this.formato =='DUCTO')
                         perfil_sn = false;
                     else
                         perfil_sn= null;
                     var urlRegistros = 'informes_ri' ;
                     this.$store.commit('loading', true);
                     axios({
                     method: 'post',
                     url : urlRegistros,
                     data : {
                         'ot'              : this.otdata,
                         'obra'            : this.obra,
                         'planta'          : this.planta,
                         'ejecutor_ensayo' : this.ejecutor_ensayo,
                         'metodo_ensayo'   : this.metodo,
                         'fecha'           : this.fecha,
                         'numero_inf'      : this.numero_inf,
                         'pk'              : this.pk,
                         'ot_tipo_soldadura' : this.ot_tipo_soldadura,
                         'reparacion_sn'     :this.reparacion_sn,
                         'prefijo'         :this.prefijo,
                         'gasoducto_sn'    :gasoducto_sn,
                         'perfil_sn'       :perfil_sn,
                         'componente'      :this.componente,
                         'linea'      :    this.linea,
                         'plano_isom' :    this.plano_isom,
                         'hoja'       :    this.hoja,
                         'procedimiento' : this.procedimiento,
                         'observaciones':  this.observaciones,
                         'material':       this.material,
                         'material2':      this.material2,
                         'material2_tipo': this.material2_tipo,
                         'diametro':       this.diametro,
                         'espesor':        this.espesor,
                         'espesor_chapa' :  this.espesor_chapa,
                         'interno_equipo'   :  this.interno_equipo,
                         'kv'               :this.kv,
                         'ma'               :this.ma,
                         'interno_fuente' :this.interno_fuente,
                         'tipo_pelicula' : this.tipo_pelicula,
                         'medida'        : this.medida,
                         'pantalla':       this.pantalla,
                         'pos_ant':        this.pos_ant,
                         'pos_pos':       this.pos_pos,
                         'lado':          this.lado,
                         'distancia_fuente_pelicula': this.distancia_fuente_pelicula,
                         'norma_evaluacion': this.norma_evaluacion,
                         'ici': this.ici,
                         'norma_ensayo': this.norma_ensayo,
                         'tecnica':this.tecnica,
                         'tecnicas_grafico' : this.tecnica_grafico,
                         'exposicion': this.exposicion,
                         'detalles'  : this.TablaDetalle,
                         'TablaPasadas' : this.TablaPasadas,
                         'TablaModelos3d' :this.TablaModelos3d,
                         'solicitado_por'    : this.solicitado_por,
                         'tramos'    : this.TablaTramos,
                         'resultado_pdf_sn' : this.resultado_pdf_sn,
                         'N_Reporte_RFI': this.N_Reporte_RFI,
                         'ptt_sn':this.ptt_sn,
                         
                 }}


                 ).then(response => {
                     let informe = response.data;
                     toastr.success('informe N°' + this.numero_inf + ' fue creado con éxito ');
                     window.open(  '/pdf/informe/ri/' + informe.id,'_blank');
                     window.location.href =  '/informes/ot/' + this.otdata.id;
                 }).catch(error => {

                     this.errors = error.response.data.errors;
                         console.log(error.response);
                     $.each( this.errors, function( key, value ) {
                         toastr.error(value);
                         console.log( key + ": " + value );
                     });
                     if((typeof(this.errors)=='undefined') && (error)){
                             toastr.error("Ocurrió un error al procesar la solicitud");

                         }
                }).finally( () => this.$store.commit('loading', false))

         },
         Update : function() {
                     this.errors =[];
                     let gasoducto_sn ;
                     if(this.formato =='DUCTO')
                         gasoducto_sn = true;
                     else if(this.formato =='PLANTA' || this.formato == 'PERFILES')
                         gasoducto_sn = false;
                     else
                         gasoducto_sn= null;
                     let perfil_sn ;
                     if(this.formato == 'PERFILES')
                        perfil_sn = true;
                     else if(this.formato =='PLANTA' || this.formato =='DUCTO')
                         perfil_sn = false;
                     else
                         perfil_sn= null;
                     var urlRegistros = 'informes_ri/' + this.informedata.id  ;
                     this.$store.commit('loading', true);
                     axios({
                     method: 'put',
                     url : urlRegistros,
                     data : {
                         'ot'              : this.otdata,
                         'updated_at'      : this.informedata.updated_at,
                         'obra'            : this.obra,
                         'planta'          : this.planta,
                         'ejecutor_ensayo' : this.ejecutor_ensayo,
                         'metodo_ensayo'   : this.metodo,
                         'fecha':          this.fecha,
                         'numero_inf':     this.numero_inf,
                         'pk':             this.pk,
                         'ot_tipo_soldadura' : this.ot_tipo_soldadura,
                         'reparacion_sn'     :this.reparacion_sn,
                         'prefijo'        :this.prefijo,
                         'gasoducto_sn' :  gasoducto_sn,
                         'perfil_sn'       :perfil_sn,
                         'componente' :    this.componente,
                         'linea'      :    this.linea,
                         'plano_isom' :    this.plano_isom,
                         'hoja'       :    this.hoja,
                         'procedimiento' : this.procedimiento,
                         'observaciones':  this.observaciones,
                         'material':       this.material,
                         'material2':      this.material2,
                         'material2_tipo': this.material2_tipo,
                         'diametro':       this.diametro,
                         'espesor':        this.espesor,
                         'espesor_chapa'    :this.espesor_chapa,
                         'interno_equipo'   :this.interno_equipo,
                         'kv'               :this.kv,
                         'ma'               :this.ma,
                         'interno_fuente' :this.interno_fuente,
                         'tipo_pelicula' : this.tipo_pelicula,
                         'medida'        : this.medida,
                         'pantalla':       this.pantalla,
                         'pos_ant':        this.pos_ant,
                         'pos_pos':       this.pos_pos,
                         'lado':          this.lado,
                         'distancia_fuente_pelicula': this.distancia_fuente_pelicula,
                         'norma_evaluacion': this.norma_evaluacion,
                         'ici': this.ici,
                         'norma_ensayo': this.norma_ensayo,
                         'tecnica':this.tecnica,
                         'tecnicas_grafico' : this.tecnica_grafico,
                         'exposicion': this.exposicion,
                         'detalles'  : this.TablaDetalle,
                         'TablaPasadas' : this.TablaPasadas,
                         'TablaModelos3d' :this.TablaModelos3d,
                         'solicitado_por'    : this.solicitado_por,
                         'tramos'    : this.TablaTramos,
                         'resultado_pdf_sn' : this.resultado_pdf_sn,
                         'N_Reporte_RFI': this.N_Reporte_RFI,
                         'ptt_sn': this.ptt_sn,


                 }}
                 ).then( response => {
                     let informe = response.data;
                     toastr.success('informe N°' + this.numero_inf + ' fue actualizado con éxito ');
                     window.open(  '/pdf/informe/ri/' + informe.id,'_blank');
                     window.location.href =  '/informes/ot/' + this.otdata.id;
                 }).catch(error => {
                     this.errors = error.response.data.errors;
                         console.log(error.response);
                     $.each( this.errors, function( key, value ) {
                         toastr.error(value);
                         console.log( key + ": " + value );
                     });
                     if((typeof(this.errors)=='undefined') && (error)){
                             toastr.error("Ocurrió un error al procesar la solicitud");
                         }
                }).finally( () => this.$store.commit('loading', false) )
         }
     }

 }
 </script>

 <style scoped>
 .form-control[disabled], .form-control[readonly], fieldset[disabled] .form-control {
      background-color: #eee;
 }
 .checkbox-inline {
     margin-left: 0px;
 }
 @media (max-width: 767px) {
     .table-responsive .dropdown-menu {
         position: static !important;
     }
 }
 @media (min-width: 768px) {
     .table-responsive {
         overflow: inherit;
     }
 }

 .tabla-detalle tr:nth-child(4n+1), .tabla-detalle tr:nth-child(4n+2) {
 background: #f2f2f2;
}

 </style>

<style>

    .v-select .vs__selected-options{
        flex-wrap: nowrap;
        white-space: nowrap;
        overflow: hidden;
    }

 </style>
